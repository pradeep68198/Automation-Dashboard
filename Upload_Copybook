<%@ page import = "java.io.*,java.util.*, javax.servlet.*" %>
<%@ page import = "javax.servlet.http.*" %>
<%@ page import = "org.apache.commons.fileupload.*" %>
<%@ page import = "org.apache.commons.fileupload.disk.*" %>
<%@ page import = "org.apache.commons.fileupload.servlet.*" %>
<%@ page import = "org.apache.commons.io.output.*" %>
<%@ page import = "java.text.SimpleDateFormat" %>
<%@ page import = "java.util.Date" %>
<%@ page import = "org.apache.commons.io.FileUtils" %>


<%!

public String contentType;
%>
<%
   File file ;
 
   int maxFileSize = 200000 * 1024;
   int maxMemSize = 200000 * 1024;
   String File_Temp = (String)session.getAttribute("Result_Folder");
   System.out.println(File_Temp);
   // Verify the content type
    contentType = request.getContentType();
    System.out.println("11");
   if ((contentType.indexOf("multipart/form-data") >= 0)) {
      DiskFileItemFactory factory = new DiskFileItemFactory();
      // maximum size that will be stored in memory
      factory.setSizeThreshold(maxMemSize);
      
      // Location to save data that is larger than maxMemSize.
      factory.setRepository(new File(File_Temp));

      // Create a new file upload handler
      ServletFileUpload upload = new ServletFileUpload(factory);
      
      // maximum file size to be uploaded.
      upload.setSizeMax( maxFileSize );
      
      try { 
         // Parse the request to get file items.
         List fileItems = upload.parseRequest(request);

         // Process the uploaded file items
         Iterator i = fileItems.iterator();

        
         
         while ( i.hasNext () ) {
            FileItem fi = (FileItem)i.next();
            if ( !fi.isFormField () ) {
               // Get the uploaded file parameters
               String fieldName = fi.getFieldName();
               String fileName = fi.getName();
               boolean isInMemory = fi.isInMemory();
               long sizeInBytes = fi.getSize();
            
               // Write the file
               if( fileName.lastIndexOf("\\") >= 0 ) {
                  file = new File( File_Temp + 
                  fileName.substring( fileName.lastIndexOf("\\"))) ;
                  
               } else {
                  file = new File( File_Temp + 
                  fileName.substring(fileName.lastIndexOf("\\")+1)) ;
                  
               }
               fi.write( file ) ;
               
               SimpleDateFormat ft = new SimpleDateFormat ("yyyy-MM-dd"); 
       		   Date date = new Date();
       		   String Date_text=ft.format(date);
       		   Random ran=new Random();
       		   int j=ran.nextInt(100000);
               String Ran_Str=Integer.toString(j);
               String File_Name=File_Temp+"Source_"+Date_text+"_"+Ran_Str+".xlsx";
              File file1= new File(File_Name);
               if(file.renameTo(file1)){
       			System.out.println("Rename succesful");
       		}else{
       			System.out.println("Rename failed");
       		}
               
	         
               session.setAttribute("Copybook_Source",File_Name);  
               session.setAttribute("Type_Source","Mainframe"); 
               
               %>
               
               <html>
<head>
<script>
  function preventBack(){window.history.forward();}
  setTimeout("preventBack()", 0);
  window.onunload=function(){null};
</script>
<title>Uploading project...</title>
<style>
/* Center the loader */
#loader {
  position: absolute;
  left: 50%;
  top: 50%;
  z-index: 1;
  width: 150px;
  height: 150px;
  margin: -75px 0 0 -75px;
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite;
  animation: spin 2s linear infinite;
}

@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Add animation to "page content" */
.animate-bottom {
  position: relative;
  -webkit-animation-name: animatebottom;
  -webkit-animation-duration: 1s;
  animation-name: animatebottom;
  animation-duration: 1s
}

@-webkit-keyframes animatebottom {
  from { bottom:-100px; opacity:0 } 
  to { bottom:0px; opacity:1 }
}

@keyframes animatebottom { 
  from{ bottom:-100px; opacity:0 } 
  to{ bottom:0; opacity:1 }
}

#myDiv {
  display: none;
  text-align: center;
}
</style>
</head>

<body onload="myFunction()" style="margin:0;">

<div id="loader"></div>

<div style="display:none;" id="myDiv" class="animate-bottom">
 <h2>Excel File Uploaded successfully...</h2><br><br>
</div>

<script>
var myVar;

function myFunction() {
    myVar = setTimeout(showPage, 3000);
    setTimeout(function () {
    	   window.location.href = "Target_DB.jsp"; //will redirect to your blog page (an ex: blog.html)
    	}, 2000);
}

function showPage() {
  document.getElementById("loader").style.display = "none";
  document.getElementById("myDiv").style.display = "block";
}
</script>
</body>
</html>


               
              
            <% }
         }
        
         
      } catch(Exception ex) {
         System.out.println(ex);
      }
   }
   else {
	      out.println("<html>");
	      out.println("<head>");
	      out.println("<title>Servlet upload</title>");  
	      out.println("</head>");
	      out.println("<body>");
	      out.println("<p>No file uploaded</p>"); 
	      out.println("<a href='Property_File.html'>Back</a>"); 
	      out.println("</body>");
	      out.println("</html>");
	   }
%>

 <%
        

    %>
