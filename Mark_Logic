package com.FMS.Func_Script;



import java.awt.AWTException;
import java.awt.Robot;
import java.awt.Toolkit;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.StringSelection;
import java.awt.event.KeyEvent;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.UnsupportedEncodingException;
import java.sql.SQLException;
import java.util.Collections;
import java.util.HashMap;

import org.openqa.selenium.By;
import org.openqa.selenium.Keys;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.chrome.ChromeOptions;
import org.openqa.selenium.htmlunit.HtmlUnitDriver;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.Select;
import org.openqa.selenium.support.ui.WebDriverWait;

import com.FMS.Utilities.General_Wrapper;
import com.jcraft.jsch.JSchException;
import com.jcraft.jsch.SftpException;

public class Mark_Logic extends General_Wrapper  {
	
	public By result=By.xpath("//*[text()='your query returned an empty sequence']");
	
	
	public String HR_HUB_ML_Launcher(String Source_DB, String query,String Unixquerypath,String filename) throws InterruptedException, AWTException, ClassNotFoundException, SQLException, JSchException, SftpException, IOException {
		

		String url=HR_HUB_ML_URL.replace("http://", "");
		String Finalurl="http://"+ML_Username+":"+ML_Pwd+"@"+url;
		driver.get(Finalurl);
		 
		 Thread.sleep(3000);
		 Select s=new Select(driver.findElement(By.id("source-databases")));
		 s.selectByVisibleText(Source_DB);
		 
		 Select s1=new Select(driver.findElement(By.id("query-type")));
		 s1.selectByVisibleText("XQuery");
		 
		 
		 driver.findElement(By.xpath("//*[@id='query-text-space']/div/div[6]/div[1]/div/div/div/div[5]/div/pre/span/span")).click();
		 Thread.sleep(2000);
		 
	
		 Actions act = new Actions(driver);
		 act.keyDown(Keys.CONTROL).sendKeys("a").keyUp(Keys.CONTROL).build().perform();
		 Thread.sleep(2000);
		 Actions act1 = new Actions(driver);
		 act1.sendKeys(Keys.DELETE).build().perform();
		 Thread.sleep(2000);
		 StringSelection stringSelection = new StringSelection(query);
			Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
			clipboard.setContents(stringSelection, stringSelection);
		 
			 Actions act2 = new Actions(driver);
			 act2.keyDown(Keys.CONTROL).sendKeys("v").keyUp(Keys.CONTROL).build().perform();
	
			 
			 driver.findElement(By.id("run-btn")).click();
			 
			   waitForElement1(result,"result");
			   
			   html_update("Transferring Query Output file to result folder");
			   Thread.sleep(10000);
			   
			   String[] multi=Unixquerypath.split(";");
			   
			   String[] Filepath=new String[multi.length];
			   
			   for(int i=0;i<multi.length;i++) {
				   
				   Filepath[i]=Download_Path+filename+i+".txt";
			       HR_HUB_Unix_Caller(Unixquerypath,Filepath[i]);
			   
			   }
			   String final_value=null;
			   if(multi.length==1) {
				   final_value= Filepath[0];
			   }
			   else {
			      final_value=new File_Merger().file_merge(Filepath);
			   }
			   
			   return final_value;
		
		
	}
	
public void ML_Launcher(String Source_DB, String query,String Unixquerypath,String filename) throws InterruptedException, AWTException, ClassNotFoundException, SQLException, JSchException, SftpException, FileNotFoundException, UnsupportedEncodingException {


		String url=FMS_ML_URL.replace("http://", "");
		String Finalurl="http://"+ML_Username+":"+ML_Pwd+"@"+url;
		
		System.out.println(Finalurl);
		driver.get(Finalurl);
		 
		 Thread.sleep(3000);
		 Select s=new Select(driver.findElement(By.id("source-databases")));
		 s.selectByVisibleText(Source_DB);
		 
		 Select s1=new Select(driver.findElement(By.id("query-type")));
		 s1.selectByVisibleText("XQuery");
		 
		 System.out.println("11");
		 driver.findElement(By.xpath("//*[@id='query-text-space']/div/div[6]/div[1]/div/div/div/div[5]/div/pre/span/span")).click();
		 Thread.sleep(2000);
		 
		 System.out.println("22");
		 Actions act = new Actions(driver);
		 act.keyDown(Keys.CONTROL).sendKeys("a").keyUp(Keys.CONTROL).build().perform();
		 Thread.sleep(2000);
		 Actions act1 = new Actions(driver);
		 act1.sendKeys(Keys.DELETE).build().perform();
		 Thread.sleep(2000);
		 System.out.println("33");
		 StringSelection stringSelection = new StringSelection(query);
			Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
			clipboard.setContents(stringSelection, stringSelection);
		 
			 Actions act2 = new Actions(driver);
			 act2.keyDown(Keys.CONTROL).sendKeys("v").keyUp(Keys.CONTROL).build().perform();
			 System.out.println("44");
			 
			 driver.findElement(By.id("run-btn")).click();
			 System.out.println("55");
			 WebDriverWait wait = new WebDriverWait(driver, 10);
		     wait.until(ExpectedConditions.textToBe(result, "your query returned an empty sequence"));
			 System.out.println("66");
			 
			 html_update("Transferring Query Output file to result folder");
			   Thread.sleep(15000);
			   System.out.println("77");  
			   Unix_Caller(Unixquerypath,Download_Path+filename);
			   System.out.println("88");
		
			 
		
	}
	
	
}
